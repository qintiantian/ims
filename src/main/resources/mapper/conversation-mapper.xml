<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xylink.mappers.ConversationDao">
    <insert id="insertConversation" parameterType="com.xylink.entity.ConversationVO">
      insert into ims_conversation(conversation_id,user_id,dest_id,conversation_type,status,ts)
      values(#{conversationId},#{userId},#{destId},#{conversationType},#{status},#{ts})
    </insert>

    <select id="selectConversationByUserId" resultType="java.util.HashMap">
        select u.img_url as imgUrl, u.nickname, d.destId, u.username, d.ts as lastDate
            from ims_user u join
            (select c.ts, (CASE
            WHEN c.user_id = #{userId} THEN
                c.dest_id
            ELSE
                c.user_id
            END) as destId
            from ims_conversation c
            where c.user_id=#{userId} or c.dest_id=#{userId}) as d
            on u.user_id = d.destId
    </select>

</mapper>